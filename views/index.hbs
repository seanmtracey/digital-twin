<main>
	<div id="top">
		
		<div id="pack">
			<div data-id="6"></div>
			<div data-id="5"></div>
			<div data-id="4"></div>
			<div data-id="3"></div>
			<div data-id="2"></div>
		</div>
		
		<div id="shelves">
			<div data-id="0"></div>
			<div data-id="1"></div>
			<div data-id="2"></div>
			<div data-id="3"></div>
			<div data-id="4"></div>
			<div data-id="5"></div>
			<div data-id="6"></div>
			<div data-id="7"></div>
			<div data-id="8 "></div>
		</div>

	</div>

	<div id="bottom">
		
		<div id="racks">

			<div class="top">

				<div data-id="F">
					<span></span>
					<span></span>
				</div>
			
			</div>

			<div class="bottom">

				<div class="left">
					<div data-id="S"></div>
					<div data-id="M"></div>
				</div>

				<div class="right">
					<div data-id="W"></div>
				</div>

			</div>

		</div>

		<div id="printarea">
			
			<div class="left">

			</div>

			<div class="right">

				<div class="column">
					<div data-id="1"></div>
					<div data-id="5"></div>
					<div data-id="2"></div>
					<div data-id="6"></div>
					<div data-id="3"></div>
					<div data-id="7"></div>
					<div data-id="4"></div>
					<div data-id="8"></div>
				</div>

				<div class="column">
					<div data-id="9"></div>
					<div data-id="13"></div>
					<div data-id="10"></div>
					<div data-id="14"></div>
					<div data-id="11"></div>
					<div data-id="15"></div>
					<div data-id="12"></div>
					<div data-id="16"></div>
				</div>

				<div class="column">
					<div data-id="17"></div>
					<div data-id="18"></div>
					<div data-id="19"></div>
					<div data-id="20"></div>
					<div data-id="21"></div>
					<div data-id="22"></div>
					<div data-id="23"></div>
					<div data-id="24"></div>
				</div>

				<div class="column">
					<div data-id="25"></div>
					<div data-id="26"></div>
					<div data-id="27"></div>
					<div data-id="28"></div>
				</div>

			</div>
			
		</div>

</main>

<div id="eventDataOverlay">
	<div id="eventDataDialog">
</div>

<script>

	(function(){
		'use strict';

		console.log('Hello!');
		
		function highlightElement(element, duration){
			document.body.setAttribute('data-displaying-info', 'true');
			element.dataset.focus = "true";

			setTimeout(function(){
				document.body.setAttribute('data-displaying-info', 'false');
				element.dataset.focus = "false";
			}, 3000);
			
		}

		const shelves = document.querySelector('#top #shelves');

		const ws = new WebSocket(`ws://${window.location.host}/`);

		ws.addEventListener('connected', function(e){
			console.log('WebSocket connected:', e);
		}, false);

		ws.addEventListener('message', function(e){
			//console.log('WebSocket message', e);

			const MESSAGE_DATA = JSON.parse(e.data);

			let DATA;

			try{
				DATA = JSON.parse(MESSAGE_DATA.data);
			} catch (err) {
				return;
			}

			//const DATA = MESSAGE_DATA.data ? JSON.parse(MESSAGE_DATA.data) : undefined;
			
			console.log(MESSAGE_DATA);
			// console.log(DATA);

			if(DATA.label_id){
				console.log('>>>>>>>>', DATA);

				/*{
					label_id: "1539041"
					label_options: {Colour: "White", Size: "XL"}
					order_id: "402096"
					pickface_location: " 6 Wb 12"
					picks_remaining: 56
					product_name: "Bella Freud Peace And Love T-shirt"
				}*/
				
				//debugger;

				switch(MESSAGE_DATA.topic){
					case "teemill/factory/picking/out":
						const location = DATA.pickface_location.split(' ').slice(1, DATA.pickface_location.split(' ').length);

						const packingLocation = shelves.querySelector(`[data-id="${ location[0] }"]`);

						if(packingLocation){
							highlightElement(packingLocation, 3000);
						}

					default:
						break;

				}





			}

		}, false);

		ws.addEventListener('error', function(err){
			console.log('WebSocket error:', err);
		}, false);

	}());

</script>