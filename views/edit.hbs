<main>

	<canvas id="creationCanvas"></canvas>

    <div id="nodes">

        <!-- The output are where nodes are persisted -->

    </div>

    <script>

        (function(){

            'use strict';

            function createNode(x, y, width, height){

                const div = document.createElement('div');
                
                div.dataset.left = x;
                div.dataset.top = y;
                div.dataset.width = width;
                div.dataset.height = height;

                div.classList.add('node');

                div.setAttribute("style", `left: ${x}px; top: ${y}px; width: ${width}px; height: ${height}px; background-color: #e6e6e6;`);

                return div;

            }

            const nodesHolder = document.querySelector('#nodes');
            const creationCanvas = document.querySelector('canvas#creationCanvas');
            const creationCtx = creationCanvas.getContext('2d');

            creationCanvas.width = window.innerWidth;
            creationCanvas.height = window.innerHeight;

            creationCtx.strokeStyle = "1px #333333";

            let CREATING = false;
            let startCoords = undefined;

            nodesHolder.addEventListener('mousedown', (e) => {
                console.log('MOUSEDOWN');
                
                CREATING = true;
                startCoords = {
                    x : e.clientX,
                    y : e.clientY
                };

            }, false);

            nodesHolder.addEventListener('mousemove', (e) => {
                console.log('mousemove');

                if(CREATING){

                    const selectionWidth = e.clientX - startCoords.x;
                    const selectionHeight = e.clientY - startCoords.y;

                    creationCtx.clearRect(0,0, creationCanvas.width, creationCanvas.height);
                    creationCtx.strokeRect(startCoords.x, startCoords.y, selectionWidth, selectionHeight);
                    creationCtx.stroke();

                }

            }, false);

            nodesHolder.addEventListener('mouseup', (e) => {
                
                console.log('MOUSEUP');
                
                creationCtx.clearRect(0, 0, creationCanvas.width, creationCanvas.height);
                
                const elementWidth = e.clientX - startCoords.x;
                const elementHeight = e.clientY - startCoords.y

                const node = createNode(startCoords.x, startCoords.y, elementWidth, elementHeight);

                nodesHolder.appendChild(node);

                CREATING = false;
                startCoords = undefined;

            }, false);

            window.addEventListener('resize', (e) => {
                creationCanvas.width = window.innerWidth;
                creationCanvas.height = window.innerHeight;
            }, false);

        }());

    </script>

</main>